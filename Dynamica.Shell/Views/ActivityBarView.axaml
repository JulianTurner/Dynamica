<reactiveUi:ReactiveUserControl
    xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:vm="clr-namespace:Dynamica.Shell.ViewModels"
    xmlns:models="clr-namespace:Dynamica.Shell.Models"
    xmlns:reactiveUi="clr-namespace:Avalonia.ReactiveUI;assembly=Avalonia.ReactiveUI"
    x:Class="Dynamica.Shell.Views.ActivityBarView"
    x:TypeArguments="vm:ActivityBarViewModel"
    x:DataType="vm:ActivityBarViewModel"
    x:CompileBindings="True"
    x:Name="Root">

  <!-- Bridge: DataContext = ViewModel -->
  <reactiveUi:ReactiveUserControl.DataContext>
    <ReflectionBinding Path="ViewModel"/>
  </reactiveUi:ReactiveUserControl.DataContext>

  <Border Background="#0AAFF0" MinWidth="48">
    <ItemsControl ItemsSource="{Binding Items}">
      <ItemsControl.ItemTemplate>
        <DataTemplate x:DataType="models:ActivityBarItem">
          <ToggleButton Margin="0,6"
                        HorizontalAlignment="Stretch"
                        HorizontalContentAlignment="Left"
                        IsChecked="{Binding IsSelected}"
                        Command="{Binding ((vm:ActivityBarViewModel)DataContext).ItemClick, ElementName=Root}"
                        CommandParameter="{Binding Id}">
            <StackPanel Orientation="Horizontal" Spacing="8">
              <TextBlock Text="{Binding Icon}" FontSize="16" VerticalAlignment="Center"/>
              <TextBlock Text="{Binding Label}" 
                         VerticalAlignment="Center"
                         IsVisible="{Binding ((vm:ActivityBarViewModel)DataContext).IsExpanded, ElementName=Root}"/>
            </StackPanel>
          </ToggleButton>
        </DataTemplate>
      </ItemsControl.ItemTemplate>
    </ItemsControl>
  </Border>
</reactiveUi:ReactiveUserControl>
